#!/bin/bash
# Generated by Ansible

set -eu -o pipefail

cd {{ site_dest }}
head=$(git log --format="%H" -n 1)
tag=$(git describe --tags $(git rev-list --tags --max-count=1))

git fetch --all
git reset --hard origin/master

# Check commit
head_now=$(git log --format="%H" -n 1)
if [ $head = $head_now ]; then
    echo "Nothing to do"
    exit 0
fi

# Check tag
tag_now=$(git describe --tags $(git rev-list --tags --max-count=1))
if [ $tag = $tag_now ]; then
    echo "No update on staging"
else
    echo "Update staging for now"
    cd {{ staging_dest }}
    git fetch --all
    git reset --hard origin/{{ staging_branch }}
fi

# Update dev
echo "Update dev for now"
cd {{ dev_dest }}
git fetch --all
git reset --hard origin/{{ dev_branch }}
